alt.modules.storage=angular.module("alt-storage",[]).factory("$storage",["$log","$q",function(e,t){return function(e,a){a=a||e+"id",store.set(alt.application+"_data",store.get(alt.application+"_data")||{});var n={table:e,pk:a,response:function(e,t){return t=t||0,{status:t,data:0==t?e:null,message:0!=t?e:""}},get:function(){var a=store.get(alt.application+"_data"),r=a[e]||[],o=t.defer();return o.resolve(n.response(r)),o.promise},save:function(a){var r=store.get(alt.application+"_data");r[e]=a,store.set(alt.application+"_data",r);var o=t.defer();return o.resolve(n.response(1)),o.promise},list:function(){return n.get()},search:function(a,r){var o=t.defer();return n.list(e).then(function(e){for(var t=e.data,s={id:-1,data:null},i=0;i<t.length;i++)if(t[i][a]==r){s.id=i,s.data=t[i][a];break}-1==s.id?o.reject(n.response("Data tidak ditemukan",s.id)):o.resolve(n.response(s))}),o.promise},count:function(){var a=t.defer();return n.list(e).then(function(e){var t=e.data,r=t.length;a.resolve(n.response(r))}),a.promise},insert:function(r){var o=t.defer();return n.list(e).then(function(e){var t=e.data;r[a]=parseInt(t[t.length-1]?t[t.length-1][a]||0:0)+1,t.push(r),n.save(t).then(function(){o.resolve(n.response(res))})}),o.promise},retrieve:function(e){var r=t.defer();return n.search(a,e).then(function(e){var t=e.data,a=t.data;r.resolve(n.response(a))},function(e){r.reject(n.response(e))}),r.promise},update:function(e){var r=t.defer();return n.list().then(function(t){var o=t.data;n.search(a,e[a]).then(function(t){var a=t.data;o[a.id]=e,n.save(o).then(function(){r.resolve(n.response(1))})},function(e){r.reject(n.response("Tidak ada data yang diupdate",-1))})}),r.promise},remove:function(e){var r=t.defer();n.list().then(function(e){var t=e.data;n.search(a,newdata[a]).then(function(e){var a=e.data;t.splice(a.id,1),n.save(t).then(function(){r.resolve(n.response(1))})},function(e){r.reject(n.response("Tidak ada data yang dihapus",-1))})})},keyvalues:function(a,r){r=r||"";var o=t.defer();return n.list(e).then(function(e){for(var t=e.data,n={},s=0;s<t.length;s++)n[t[s][a]]=""!=r?t[s][r]:t[s];o.resolve(n)}),o.promise},isexist:function(e,a){var r=t.defer();return n.list().then(function(t){for(var n=t.data,o=0,s=0;s<n.length;s++)o+=n[s][e]==a?1:0;r.resolve(o)}),r.promise}};return n}}]),alt.module("alt-storage",alt.modules.storage);